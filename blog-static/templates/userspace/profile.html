<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>个人中心</title>
  <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../static/font-awesome-4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.bootcss.com/cropper/4.0.0/cropper.min.css">
  <link rel="stylesheet" href="../../static/css/sticky-footer-navbar.css">
  <link rel="stylesheet" href="../../static/css/index.css">
  <link rel="stylesheet" href="../../static/css/crapper-avatar.css">

</head>
<body>

  <!-- header -->
  <div></div>

  <main class="container" role="main">
    <div class="row">
      <!-- 左侧栏目 -->
      <div class="col-md-3">
        <div class="card mb-3">
          <div class="card-body text-center">
            <a href="#" class="" data-toggle="modal" data-target="#exampleModalCenter" role="button">
              <img class="blog-avatar blog-avatar-160" src="../../static/images/avatar-default-1.jpg"/>
            </a>
            <h5>一舞翩跹</h5>
          </div>
        </div><!-- .card end -->

        <div class="card mb-3">
          <div class="card-header">
            <i class="fa fa-cog" aria-hidden="true"><span> 个人设置</span></i>
          </div>
          <div class="card-body ">
            <ul class="list-group list-group-flush ">
              <li class="list-group-item pl-0">
                <a href="#" class="card-link">修改个人资料</a>
              </li>
              <li class="list-group-item pl-0">
                <a href="#" class="card-link">修改个人密码</a>
              </li>
              <li class="list-group-item pl-0">
                <a class="card-link">修改头像图片</a>
              </li>
            </ul>
          </div>
        </div><!-- .card end -->
      </div>

      <!-- 右侧栏目 -->
      <div class="col-md-9">
        <!-- 个人设置-修改个人信息 -->
        <!--<div class="card ">
          <h5 class="card-header">修改密码</h5>
          <div class="card-body">
            <form>
              <div class="form-group">
                <label for="oldPassword" class="col-form-label ">旧密码</label>
                <input type="password" class="form-control" id="oldPassword" maxlength="50" placeholder="请输入旧密码">
              </div>
              <div class="form-group">
                <label for="newPassword" class="col-form-label ">新密码</label>
                <input type="password" class="form-control" id="newPassword" maxlength="50" placeholder="请输入新密码">
              </div>
              <div class="form-group">
                <label for="repeatPassword" class="col-form-label">确认新密码</label>
                <input type="password" class="form-control" id="repeatPassword" maxlength="20" placeholder="请再次输入新密码">
              </div>
              <div class="form-group">
                <button type="button" class="btn btn-primary">提交</button>
              </div>
            </form>
          </div>
        </div>--><!-- .card end -->
        <!-- 个人设置-修改密码 -->
        <div class="card ">
          <h5 class="card-header">个人设置</h5>
          <div class="card-body">
            <form method="post">
              <div class="form-group">
                <label for="username" class="col-form-label">账号</label>
                <input type="text" class="form-control" id="username" readonly="readonly">
              </div>
              <div class="form-group">
                <label for="email" class="col-form-label ">邮箱</label>
                <input type="email" class="form-control" id="email" maxlength="50" placeholder="请输入邮箱">
              </div>
              <div class="form-group">
                <label for="name" class="col-form-label">昵称</label>
                <input type="text" class="form-control" id="name" maxlength="20" placeholder="请输入昵称，至少2个字符，至多20个">
              </div>
              <div class="form-group">
                <label for="password" class="col-form-label">密码</label>
                <input type="password" class="form-control" id="password" maxlength="30" readonly="readonly">
              </div>
              <div class="form-group">
                <button type="button" class="btn btn-primary">保存</button>
              </div>
            </form>
          </div>
        </div><!-- .card end -->
      </div><!-- 右侧栏目 end -->
    </div><!-- .row end-->
  </main><!-- .container end-->


  <!-- The modal -->
  <div class="modal fade  " id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="modalLabel">编辑头像</h4>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="container-fluid">
            <div class="row">
              <div class="col-md-12">
                <label class="btn btn-primary btn-upload" for="inputImage" title="选择本地图片">
                  <input type="file" class="sr-only" id="inputImage" name="file" accept=".jpg,.jpeg,.png,.gif,.bmp,.tiff">
                  <span title="选择本地图片">选择本地图片</span>
                </label>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-9">
                <div class="img-container">
                  <img id="image" src="../../static/images/avatar-cropper.jpg" alt="头像"/>
                </div>
              </div>
              <div class="col-md-3">
                <div class="img-preview preview-rect"></div>
                <div class="img-preview preview-round"></div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-9 ">
                <div class="btn-group">
                  <button class="btn btn-primary" id="button-rotate-left" title="向左旋转"><span class="fa fa-rotate-left"></span></button>
                  <button class="btn btn-primary" id="button-rotate-right" title="向右旋转"><span class="fa fa-rotate-right"></span></button>
                </div>
                <div class="btn-group">
                  <button class="btn btn-primary" id="button-scalex" title="左右反转"><span class="fa fa-arrows-h"></span></button>
                  <button class="btn btn-primary" id="button-scaley" title="上下反转"><span class="fa fa-arrows-v"></span></button>
                </div>
                <div class="btn-group">
                  <button class="btn btn-primary" id="button-crop" title="生成裁剪框"><span class="fa fa-check"></span></button>
                  <button class="btn btn-primary" id="button-clear" title="移除裁剪框"><span class="fa fa-remove"></span></button>
                </div>
                <div class="btn-group">
                  <button class="btn btn-primary" id="button-reset" title="重置"><span class="fa fa-refresh"></span></button>
                  <button class="btn btn-primary" id="button-destroy" title="如果cropper销毁了，那就刷新页面吧"><span class="fa fa-power-off"></span></button>
                </div>
              </div>
              <div class="col-md-3">
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" data-dismiss="modal" id="submitEdit">提交</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>

  </div><!-- .modal end -->

  <!-- footer -->
  <div></div>

  <!-- Bootstrap -->
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdn.bootcss.com/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <!-- Cropper -->
  <script src="https://cdn.bootcss.com/cropper/4.0.0/cropper.min.js"></script>
  <script>
      function preview() {
          var previews = document.getElementsByClassName('img-preview')
          var width = '162px'
          previews[0].style.width = width
          previews[0].style.height = width
          previews[0].firstChild.style.width = 'inherit'
          previews[0].firstChild.style.height = 'inherit'
          previews[1].style.width = width
          previews[1].style.height = width
          previews[1].firstChild.style.width = 'inherit'
          previews[1].firstChild.style.height = 'inherit'

          var crop = $image.cropper('getCropBoxData')
          //console.log(crop)
          previews[0].firstChild.style.position = 'fixed'
          var rect = 'rect(' + crop.top + 'px, ' + crop.width + 'px, ' + crop.height + 'px, ' + (crop.left-86.09400998336108) +'px)'
          console.log(rect)
          previews[0].firstChild.style.clip = rect
      }

      var $image = $('#image')
      $image.cropper({
          aspectRatio: 1 / 1, // 正方形
          viewMode: 1, // 裁剪框不能超过图片
          dragMode: 'move',
          preview: '.img-preview',
          minContainerWidth: 544,
          minContainerHeight: 361,
          ready: () => {
              //console.log('ready')
              //preview()
          },
          cropend: () => {
              //console.log('cropend')
              //preview()
          },
          crop: function (e) {
              //console.log('crop')
              //preview()
          },
      })
      var cropper = $image.data('cropper')

      $('#button-rotate-left').on('click', function () {
          cropper.rotate(-45)
      })
      $('#button-rotate-right').on('click', function () {
          cropper.rotate(45)
      })
      $('#button-scalex').on('click', function () {
          // 获取原本的 scaleX 取反
          var x = cropper.getData().scaleX;
          cropper.scaleX(-x)
      })
      $('#button-scaley').on('click', function () {
          cropper.scaleY(-(cropper.getData().scaleY))
      })
      $('#button-crop').on('click', function () {
          cropper.crop()
      })
      $('#button-clear').on('click', function () {
          cropper.clear()
      })
      $('#button-reset').on('click', function () {
          cropper.reset()
      })
      $('#button-destroy').on('click', function () {
          cropper.destroy()
      })

      $('#inputImage').on('change', function () {
          var files = this.files;
          var file;
          var URL;
          var uploadedImageURL;
          if (files && files.length) {
              file = files[0];

              if (uploadedImageURL) {
                  URL.revokeObjectURL(uploadedImageURL);
              }

              URL = window.URL;
              uploadedImageURL = URL.createObjectURL(file);

              cropper.replace(uploadedImageURL)
          }
          $('#inputImage').val('')
      })
  </script>

</body>
</html>