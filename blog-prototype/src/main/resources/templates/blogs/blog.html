<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head th:replace="~{fragments/head-meta :: head-meta}">
<meta charset="UTF-8">
<title>Thymeleaf in action</title>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.bootcss.com/chosen/1.8.8.rc6/chosen.css">
<link rel="stylesheet" href="https://cdn.bootcss.com/jquery-tagsinput/1.3.6/jquery.tagsinput.min.css">
<link rel="stylesheet" href="../../static/font-awesome-4.7.0/css/font-awesome.min.css" th:href="@{~/font-awesome-4.7.0/css/font-awesome.min.css}">
<link rel="stylesheet" href="https://cdn.bootcss.com/toastr.js/latest/css/toastr.min.css">
<link rel="stylesheet" href="../../static/css/sticky-footer-navbar.css" th:href="@{~/css/blog.css}">
</head>
<body>

<div th:replace="~{fragments/header :: header}"></div>

<main class="container blog-content-container">
  <div class="row">
    <!-- Blog Entries Column -->
    <div class="col-md-9">
      <!-- Blog Post -->
      <div class="card mb-4">
          <div class="card-body">
            <!-- 头像及标题 -->
            <h5 class="card-title">
              <a href="#" class="card-link" th:title="${blogModel.user.username}" th:text="${blogModel.title}">OAuth 2.0 认证的原理与实践</a>
            </h5>
            <div class="card-text" th:text="${blogModel.summary}">
              <p>使用 OAuth 2.0 认证的的好处是显然易见的。你只需要用同一个账号密码，就能在各个网站进行访问，而免去了在每个网站都进行注册的繁琐过程。本文将介绍 OAuth 2.0 的原理，并基于 Spring Security 和 GitHub 账号，来演示 OAuth 2.0 的认证的过程。</p>
            </div>
            <!-- 发布信息 -->
            <div class="card-text d-flex justify-content-between">
              <div>
                <span>
                  <a class="card-link text-muted" href="../userspace/user.html" th:text="${blogModel.user.name}" th:href="'/u/' + ${blogModel.user.username}">一舞翩跹</a>
                </span>
                <span class="ml-2">
                  <a href="/blogs/blog-editj.html" th:if="${isBlogOwner}" th:href="'/blogs/edit/'+ ${blogModel.id}"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></a>
                  <a class="blog-delete-blog" href="javascript:void(0)" th:if="${isBlogOwner}"><i class="fa fa-times" aria-hidden="true" ></i></a>
              </span>
              </div>
              <div>
                <span class="text-muted" th:text="${#dates.format(blogModel.createTime, 'yyyy-MM-dd HH:mm')}">2017-03-17</span>
                <span class="ml-2"><i class="fa fa-eye" aria-hidden="true"></i> [[${blogModel.readSize}]]</span>
                <span class="ml-2"><i class="fa fa-heart-o" aria-hidden="true"></i> [[${blogModel.voteSize}]]</span>
                <span class="ml-2"><i class="fa fa-comment-o"aria-hidden="true"></i> [[${blogModel.commentSize}]]</span>
              </div>
            </div>
            <hr>
            <article class="post-content" th:utext="${blogModel.htmlContent}">
              <h2 id="什么是-oauth-20">什么是 OAuth 2.0</h2>
              <p>OAuth 2.0 的规范可以参考 ： <a href="https://tools.ietf.org/html/rfc6749">RFC 6749</a></p>
              <p>OAuth 是一个开放标准，允许用户让第三方应用访问该用户在某一网站上存储的私密的资源（如照片，视频，联系人列表），而无需将用户名和密码提供给第三方应用。目前，OAuth 的最新版本为2.0</p>
              <p>OAuth允许用户提供一个令牌，而不是用户名和密码来访问他们存放在特定服务提供者的数据。每一个令牌授权一个特定的网站（例如，视频编辑网站)在特定的时段（例如，接下来的2小时内）内访问特定的资源（例如仅仅是某一相册中的视频）。这样，OAuth允许用户授权第三方网站访问他们存储在另外的服务提供者上的信息，而不需要分享他们的访问许可或他们数据的所有内容。</p>
              <h2 id="oauth-20-的核心概念">OAuth 2.0 的核心概念</h2>
              <p>OAuth 2.0 主要有4类角色：</p>
              <ul>
                <li>resource owner：资源所有者，指终端的“用户”（user）</li>
                <li>resource server：资源服务器，即服务提供商存放受保护资源。访问这些资源，需要获得访问令牌（accesstoken）。它与认证服务器，可以是同一台服务器，也可以是不同的服务器。如果，我们访问新浪博客网站，那么如果使用新浪博客的账号来登录新浪博客网站，那么新浪博客的资源和新浪博客的认证都是同一家，可以认为是同一个服务器。如果，我们是新浪博客账号去登录了知乎，那么显然知乎的资源和新浪的认证不是一个服务器。</li>
                <li>client：客户端，代表向受保护资源进行资源请求的第三方应用程序。</li>
                <li>authorization server： 授权服务器， 在验证资源所有者并获得授权成功后，将发放访问令牌给客户端</li>
              </ul>
              <h2 id="oauth-20-的认证流程">OAuth 2.0 的认证流程</h2>
              <p>认证流程如下：</p>
              <ul>
                <li>（A）用户打开客户端以后，客户端请求资源所有者（用户）的授权。</li>
                <li>（B）用户同意给予客户端授权。</li>
                <li>（C）客户端使用上一步获得的授权，向认证服务器申请访问令牌。</li>
                <li>（D）认证服务器对客户端进行认证以后，确认无误，同意发放访问令牌。</li>
                <li>（E）客户端使用访问令牌，向资源服务器申请获取资源。</li>
                <li>（F）资源服务器确认令牌无误，同意向客户端开放资源。</li>
              </ul>
              <p>其中，用户授权有四种模式：</p>
              <ul>
                <li>授权码模式（authorization code）</li>
                <li>简化模式（implicit）</li>
                <li>密码模式（resource owner password credentials）</li>
                <li>客户端模式（client credentials）</li>
              </ul>
              <h2>源码</h2>
              <ul>
                <li>《Spring Security 教程》：<a href="https://github.com/waylau/spring-security-tutorial/tree/master/samples/oauth2-github">https://github.com/waylau/spring-security-tutorial/tree/master/samples/oauth2-github</a></li>
              </ul>
            </article>
            <hr>
            <div>
            <h5>分类：
              <a th:href="'/u/'+${blogModel.user.username}+'/blogs?catalog='+${blogModel.catalog.id}" th:text="${blogModel.catalog.name}">Spring Data</a>
            </h5>
            <h5>标签：
              <a href="#" th:each="tag : ${#strings.arraySplit(blogModel.tags, ',')}" th:href="'/u/' + ${blogModel.user.username} + '/blogs?keyword='+ ${tag}"> <span class="badge badge-secondary" th:text="${tag}">Web Design</span></a>
              <!-- /*
              <a href="/u/waylau/blogs?keyword=分布式"> <span class="badge badge-secondary">Jersey</span></a>
              <a href="/u/waylau/blogs?keyword=分布式"> <span class="badge badge-secondary">JavaScript</span></a>
              <a href="/u/waylau/blogs?keyword=分布式"> <span class="badge badge-secondary">CSS</span></a>
              <a href="/u/waylau/blogs?keyword=分布式"> <span class="badge badge-secondary">Java</span></a>
              <a href="/u/waylau/blogs?keyword=分布式"> <span class="badge badge-secondary">Freebies</span></a>
              */ -->
            </h5>
            </div>
             <div class="d-flex justify-content-center mt-4">
               <div class="px-2">
                 <div class="btn-group" role="group" aria-label="Basic example">
                   <button type="button" class="btn btn-outline-secondary">
                     <i class="fa fa-heart-o" aria-hidden="true"></i>
                     <span>点赞</span>
                   </button>
                   <button type="button" class="btn btn-outline-secondary">0</button>
                 </div>
               </div>
               <div class="px-2">
                 <div class="btn-group" role="group">
                   <button type="button" class="btn btn-outline-secondary">
                     <i class="fa fa-star-o" aria-hidden="true"></i>
                     <span>收藏</span>
                   </button>
                   <button type="button" class="btn btn-outline-secondary">0</button>
                 </div>
               </div>
             </div>
          </div>
          <hr class="my-0"><!-- 评论 -->
          
          <div class="card-body">
            <div class="card-title">
              <h5>评论：</h5>
            </div>
            <div id="mainContainer">
            <div id="mainContainerRepleace" th:each="comment,commentStat : ${comments}" th:object="${comment}">
            <div class="card-text row">
              <div class="col-md-2 col-lg-1">
                <span>
                  <a href="../userspace/user.html" title="一舞翩跹" th:href="'/u/'+ *{user.username}" th:title="*{user.username}">
                    <img src="../../static/images/avatar-defualt.jpg" class="blog-avatar-50" alt="一舞翩跹" th:src="*{user.avatar}==null ? '/images/avatar-defualt.jpg' : *{user.avatar}" />
                  </a>
                </span>
              </div>
              <div class="col-md-10 col-lg-11 ">
                <div class="small text-muted d-flex justify-content-between">
                  <div>
                    <span>
                      <a href="#" class="text-muted font-weitht-bold" th:href="'/u/'+ *{user.username}" th:text="*{user.name}">一舞翩跹</a>
                    </span>
                    <span class="ml-2">
                      <a href="javascript:void(0)" class="blog-delete-comment" th:if="${commentOwner} eq *{user.username}" th:attr="commentId=*{id}"><i class="fa fa-trash-o" aria-hidden="true"></i></a>
                    </span>
                  </div>
                  <div>
                    <span class="text-grey ml-2" th:text="${#dates.format(comment.createTime, 'yyyy-MM-dd HH:mm')}">2017-03-17 14:20</span>
                    <span class="text-grey ml-2 text-right" th:text="${commentStat.count} + '楼'">1楼</span>
                  </div>
                </div>
                <div th:text="*{content}">赞！</div>
              </div>
            </div>
            <hr>
            </div>
            </div>
            <div class="card-text row">
              <div class="col-lg-12">
                <textarea class="blog-textarea" placeholder="看帖需留言~" id="commentContent"></textarea>
                <button class="btn btn-info float-right ml-2" id="submitComment">发表评论</button>
              </div>
            </div>
          </div>
      </div><!-- card end -->
    </div>
    
    <!-- 右侧栏目 -->
    <div class="col-md-3">
      <div>
        <!-- 文章目录 -->
        <div class="card ">
          <span class="card-header"><i class="fa fa-bars" aria-hidden="true"></i> 文章目录</span>
          <div class="card-body">
            <div class="row">
                <div id="catalog" class="col-lg-12"></div>
            </div>
          </div>
        </div>
      </div>
    </div><!-- 右侧栏目 end -->
    
  </div><!-- .row -->
</main><!-- .container -->

<div th:replace="~{fragments/footer :: footer}"></div>

<!-- Javascript -->
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<!-- toastr 通知插件 -->
<script src="https://cdn.bootcss.com/toastr.js/latest/js/toastr.min.js"></script>
<script th:inline="javascript">
	var blogId = [[${blogModel.id}]];
	var blogUrl = [('"/blogs/' + ${blogModel.id} + '"')];
</script>
<script src="../../static//js/catalog-generator.js" th:src="@{/js/catalog-generator.js}"></script>
<script src="../../static/js/blogs/blog.js" th:src="@{/js/blogs/blog.js}"></script>

</body>
</html>